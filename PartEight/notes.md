### 搬移特性



#### 搬移函数

- 动机：频繁引用其他上下文中的元素，而对自身上下文中的元素却关心甚少
- 做法：
  - 检查函数在当前上下文里引用的所有程序元素(包括变量和函数)，考虑是否需要将它们一并搬移
  - 检查待搬移函数是否具备多态性
  - 将函数复制一份到目标上下文中。调整函数，使它能适应新家
  - 执行静态检查
  - 设法从源上下文中正确引用目标函数
  - 修改源函数，使之成为一个纯委托函数
  - 测试
  - 考虑对源函数使用`内联函数`


#### 搬移字段

- 动机：如果更新一个字段的时候需要在多个结构中进行修改，就是一个信号
- 做法： 
  - 确保源字段已经得到了良好封装
  - 测试
  - 在目标对象上创建一个字段(及对应的访问函数)
  - 执行静态检查
  - 确保源对象里能够正常引用目标对象
  - 调整对象的访问函数，令其使用目标对象的字段
  - 测试
  - 移除源对象上的字段
  - 测试


#### 搬移语句到函数

- 动机：当发现调用某些函数的时候，总有一些相同的代码也需要每次执行的时候；当某些语句与一个函数放在一起更像一个整体的时候
- 做法：
  - 如果重复的代码段离调用目标函数的地方还有些距离，则先用`移动语句`将这些语句挪动到紧邻目标函数的位置
  - 如果目标函数仅被唯一一个源函数使用，那么只需将源函数中的重复代码段剪切并粘贴到目标函数中即可，然后运行测试。本做法的后续步骤至此可以忽略
  - 如果函数不止一个调用点，那么先选择其中一个调用点应用`提炼函数`，将待搬移的语句与目标函数一起提炼成一个新函数。给新函数取个临时的名字，只要易于搜索即可
  - 调整函数的其他调用点，令它们调用新提炼的函数。每次调整之后运行测试
  - 完成所有引用点的替换后，应用`内联函数`将目标函数内联到新函数里，并移除原目标函数
  - 对新函数应用`函数改名`，将其改名为原目标函数的名字


#### 搬移语句到调用者

- 动机：以往在多个地方共用的行为，如今需要在某些调用点面前表现出不同的行为
- 做法：
  - 最简单的情况下，原函数非常简单，其调用者也只有寥寥一两个，此时只需要把要搬移的代码从函数里剪切出来并粘贴回调用端即可，必要的时候做些调整。运行测试。如果测试通过，本手法可以到此为止
  - 若调用点不止一两个，则需要先用`提炼函数`将你不想搬移的代码提炼成一个新函数，函数名可以临时起一个，只要后续容易搜索即可
  - 对原函数应用`内联函数`
  - 对提炼出来的函数应用`改变函数声明`，令其与原函数使用同一个名字


#### 移动语句

- 动机：让存在关联的东西一起出现，可以是代码更容易理解
- 做法：
  - 确定待移动的代码片段应该被搬往何处。仔细检查待移动片段与目的地之前的语句，看看搬移后是否会影响这些代码正常工作。如果会则放弃这项重构
  - 剪切源代码片段，粘贴到上一步选定的位置上
  - 测试


#### 拆分循环

- 动机：当一个循环中，做了多件事情的时候，需要对循环进行拆分
- 做法：
  - 复制一遍循环代码
  - 识别并移除循环中的重复代码，使每个循环只做一件事情
  - 测试
  > 完成循环拆分后，考虑对得到的每个循环应用`提炼函数`