### 第一组重构

#### 提炼函数

- 动机： 将意图与实现分离
- 做法：
  - 创造一个函数，根据意图进行命名
  - 将待提炼的代码从源函数中复制到新建的目标函数中
  - 检查提炼出来的函数，看看是否引用了一些无法在新函数中使用的变量，处理这些变量
  - 处理完变量后，编译
  - 在源函数中替换代码
  - 测试
  - 查看是否有相同或相似的代码段，如果有，考虑替换为提炼出来的新函数
- 范例
  - 如果无局部变量，可以直接替换
  - 有局部变量，作为参数传入
  - 如果对局部变量有赋值，可以移动变量声明到使用处，提炼出代码后，统一返回需要赋值的局部变量

#### 内联函数

- 动机：函数内容和其名称同样清晰易读时；有一群组织不合理的函数，可以先内联，然后重新提炼函数时
- 做法
  - 检查函数，确定不具多态性
  - 找出函数所有调用点
  - 将所有调用点替换为函数本体
  - 每次替换后执行测试
  - 删除函数的定义
- 范例
  - 简单情况，直接把返回或者函数内容直接替换
  - 如果有参数并返回，需要修改参数为对应的值

#### 提炼变量

- 动机：表达式非常复杂而难以阅读
- 做法：
  - 确认要提炼的表达式没有副作用
  - 声明一个不可修改的变量，复制要提炼的表达式，把结果赋值给变量
  - 用这个新变量替换原来的表达式
  - 测试
- 范例：
  - 一般情况，直接提炼即可
  - 在一个类中的话，更好的是提炼为一个get函数


#### 内联变量

- 动机：当变量名字并不能比表达式本身更具表现力的时候
- 做法：
  - 检查确认变量赋值语句的右侧表达式没有副作用
  - 如果变量没有被声明为不可修改，先将其设置为不可修改，并进行测试；为了确保变量只被赋值了一次
  - 找到第一处使用变量的地方，将其替换为直接表达式
  - 测试
  - 重复前两步，逐一替换
  - 删除变量的声明和赋值
  - 测试

#### 改变函数声明

- 动机：为了使阅读的时候更好的理解代码函数的功能，提高代码复用，函数的封装度
- 做法：
  - 简单的做法：
    - 如果要移除一个参数，需要确定函数体内没有使用该参数
    - 修改函数声明，使其成为你期望的状态
    - 找出所有使用旧函数声明的地方，将它们改为使用新函数声明
    - 测试
  - 迁移式做法：
    - 如果有必要的话，先对函数体内部加以重构，是后面的提炼步骤易于展开
    - 使用`提炼函数`将函数体提炼成一个新的函数
    - 如果提炼出的函数需要新增参数，用前面的简单做法添加即可
    - 测试
    - 对旧函数使用内联函数
    - 如果新函数使用了临时的名字，再次使用`改变函数声明`将其改回原来的名字
    - 测试
- 范例：
  - 函数改名(简单做法)：直接替换即可，如果有些困难，直接换成迁移式做法
  - 函数改名(迁移式做法)：先对整体函数使用`提炼函数`，然后逐步修改，直到可以替换所有调用者的时候，删除原来的函数；如果有无权限修改的调用，可以暂时标记为不建议使用，如果调用方全部替换了，可以把老函数删除
  - 添加参数：首先`提炼函数`，用老函数去调用新函数，在新函数中添加参数，然后在老函数调用的时候加入参数；在js中可以使用`assert(引入断言)`保证调用新函数的时候使用了新的参数，防止有没有修改的地方，最后对源函数进行`内联函数`，是函数调用者直接调用新函数，全部替换完成，就可以删除老函数，并替换新函数的名字为想要的名字，如果有必要还可以再一次进行迁移式做法
  - 把参数改为属性：当函数内部需要使用参数的某一个属性的时候，希望传入的为需要的属性，不需要其他的传入，首先`提炼变量`，把希望传入的属性独立出来，然后`提炼函数`，这时在源函数中`内联变量`，然后找到调用函数的地方，进行`内联函数`，把老函数的调用替换为新函数，当老函数调用替换完后，再次使用`改变函数声明`，把新函数的名字改为老名字，剔除老函数


#### 封装变量

- 动机：重构时迁移广泛使用的数据，还可以在函数内对数据进行校验和更新
- 做法：
  - 创建封装函数，在其中访问和更新变量值
  - 执行静态检查
  - 逐一修改使用该变量的代码，将其改为调用合适的封装函数。每次替换后执行测试
  - 限制变量的可见性
  - 测试
  - 如果变量的值是一个记录，考虑使用`封装记录`
- 范例：
  把变量变成两个函数，分别为取值函数和设置函数，并且根据需要，最好在取值函数中，考虑是否需要返回一个拷贝值，防止外部没有通过设置函数设置值的情况